<section class="{{ section.settings.class }} testimonial-slider-section {{ section.settings.font_size }}">
  <div class="page-width">
    {% if section.settings.heading or section.settings.heading_fi %}
      {% assign current_language = localization.language.iso_code %}
      {% if current_language == 'fi' and section.settings.heading_fi %}
        <h2 class="testimonial-heading">{{ section.settings.heading_fi }}</h2>
      {% else %}
        <h2 class="testimonial-heading">{{ section.settings.heading }}</h2>
      {% endif %}
    {% endif %}

    {% comment %} Use global testimonials if testimonial_ids is specified, otherwise fall back to blocks {% endcomment %}

    {% if section.settings.testimonial_ids != blank %}
      {% assign testimonial_ids_string = section.settings.testimonial_ids | replace: ' ', '' %}
      {% assign testimonial_ids = testimonial_ids_string | split: ',' %}

      {% render 'testimonials-section', testimonial_ids: testimonial_ids, font_size: section.settings.font_size %}
    {% else %}
      <div class="testimonial-slider">
        {% for block in section.blocks %}
          <div class="testimonial-item {{ block.settings.font_size }}">
            {% if block.settings.image %}
              <img src="{{ block.settings.image | img_url: "master" }}" alt="{{ block.settings.name }}" class="testimonial-image">
            {% endif %}
            <div class="testimonial-content">
              <p class="testimonial-name">{{ block.settings.name }}</p>
              <div class="testimonial-stars">
                {% for i in (1..5) %}
                  {% if i <= block.settings.rating %}
                    <span class="star filled">&#9733;</span>
                  {% else %}
                    <span class="star">&#9733;</span>
                  {% endif %}
                {% endfor %}
              </div>
              {% assign current_language = localization.language.iso_code %}
              {% if current_language == 'fi' and block.settings.quote_fi != blank and block.settings.quote_fi != 'Tämä tuote muutti elämäni! Hämmästyttävä laatu ja maku.' %}
                <p class="testimonial-quote">"{{ block.settings.quote_fi }}"</p>
              {% else %}
                <p class="testimonial-quote">"{{ block.settings.quote }}"</p>
              {% endif %}
            </div>
          </div>
        {% endfor %}
      </div>
    {% endif %}
  </div>
</section>

<script>
 document.addEventListener("DOMContentLoaded", function () {
    $('.testimonial-slider').slick({
      dots: false,
      arrows: true,
      autoplay: true,
      autoplaySpeed: 4000,
      slidesToShow: 4,
      slidesToScroll: 1,
      adaptiveHeight: false,
      prevArrow: '<button type="button" class="slick-prev"><img src="https://cdn.shopify.com/s/files/1/0943/2753/8001/files/arrow-lt.png" alt="Arrow Left"></button>',
      nextArrow: '<button type="button" class="slick-next"><img src="https://cdn.shopify.com/s/files/1/0943/2753/8001/files/arrow-rt.png" alt="Arrow Right"></button>',
      responsive: [
        {
          breakpoint: 1024,
          settings: {
            slidesToShow: 2
          }
        },
        {
          breakpoint: 768,
          settings: {
            slidesToShow: 1
          }
        }
      ]
    });
  });
</script>

{% schema %}
{
  "name": "Testimonials Slider",
  "settings": [
    {
      "type": "text",
      "id": "class",
      "label": "Add A Class"
    },
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "OVER 90% OF CUSTOMERS RECOMMEND OUR PRODUCTS"
    },
    {
      "type": "text",
      "id": "heading_fi",
      "label": "Heading (Finnish)",
      "default": "YLI 90% ASIAKKAISTA SUOSITTELEE TUOTTEITAMME"
    },
    {
      "type": "select",
      "id": "font_size",
      "label": "Font Size",
      "options": [
        { "value": "font-size-sm", "label": "Small" },
        { "value": "font-size-md", "label": "Medium" },
        { "value": "font-size-lg", "label": "Large" }
      ],
      "default": "font-size-md"
    },
    {
      "type": "text",
      "id": "testimonial_ids",
      "label": "Global Testimonial IDs",
      "info": "Enter comma-separated testimonial IDs to use global testimonials (e.g., 1,3,5). Leave blank to use blocks below.",
      "placeholder": "1,2,3,4,5"
    }
  ],
  "blocks": [
    {
      "type": "testimonial",
      "name": "Testimonial",
      "settings": [
        {
          "type": "image_picker",
          "id": "image",
          "label": "Customer Image"
        },
        {
          "type": "text",
          "id": "name",
          "label": "Customer Name",
          "default": "Jane Doe"
        },
        {
          "type": "textarea",
          "id": "quote",
          "label": "Testimonial (English)",
          "default": "This product changed my life! Amazing quality and taste."
        },
        {
          "type": "textarea",
          "id": "quote_fi",
          "label": "Testimonial (Finnish)",
          "default": "Tämä tuote muutti elämäni! Hämmästyttävä laatu ja maku."
        },
        {
        "type": "range",
        "id": "rating",
        "label": "Star Rating",
        "min": 1,
        "max": 5,
        "step": 1,
        "default": 5
      },
        {
          "type": "select",
          "id": "font_size",
          "label": "Font Size",
          "options": [
            { "value": "font-size-sm", "label": "Small" },
            { "value": "font-size-md", "label": "Medium" },
            { "value": "font-size-lg", "label": "Large" }
          ],
          "default": "font-size-sm"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Testimonials",
      "category": "Homepage"
    }
  ]
}
{% endschema %}